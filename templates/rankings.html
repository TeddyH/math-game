<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìˆ˜í•™ ê²Œì„ - ë­í‚¹</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <span class="navbar-brand">ğŸ† ìˆ˜í•™ ê²Œì„ ë­í‚¹</span>
            <div class="navbar-nav ms-auto">
                <a href="/" class="nav-link text-white">ğŸ  í™ˆìœ¼ë¡œ</a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row">
            <div class="col-lg-8 mx-auto">
                <div class="card shadow-lg">
                    <div class="card-header bg-warning text-dark text-center">
                        <h2 class="mb-0">ğŸ† ìµœê³  ì ìˆ˜ ë­í‚¹</h2>
                        <p class="mb-0">ìƒìœ„ 10ëª…ì˜ ìˆ˜í•™ ì²œì¬ë“¤</p>
                    </div>
                    <div class="card-body">
                        <div id="loadingMessage" class="text-center p-4">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">ë¡œë”©ì¤‘...</span>
                            </div>
                            <p class="mt-2">ë­í‚¹ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                        </div>

                        <div id="rankingTable" style="display: none;">
                            <div class="table-responsive">
                                <table class="table table-striped table-hover">
                                    <thead class="table-primary">
                                        <tr>
                                            <th scope="col" class="text-center">ìˆœìœ„</th>
                                            <th scope="col">ì´ë¦„</th>
                                            <th scope="col">í•™êµ</th>
                                            <th scope="col" class="text-center">í•™ë…„</th>
                                            <th scope="col" class="text-center">ì ìˆ˜</th>
                                            <th scope="col" class="text-center">ë‹¬ì„±ì¼ì‹œ</th>
                                        </tr>
                                    </thead>
                                    <tbody id="rankingBody">
                                        <!-- ë­í‚¹ ë°ì´í„°ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <div id="noDataMessage" class="text-center p-4" style="display: none;">
                            <div class="text-muted">
                                <h4>ğŸ¯ ì•„ì§ ë­í‚¹ì´ ì—†ìŠµë‹ˆë‹¤</h4>
                                <p>ì²« ë²ˆì§¸ ìˆ˜í•™ ì²œì¬ê°€ ë˜ì–´ë³´ì„¸ìš”!</p>
                                <a href="/" class="btn btn-primary">ê²Œì„ ì‹œì‘í•˜ê¸°</a>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="text-center mt-4">
                    <a href="/" class="btn btn-outline-primary btn-lg">
                        ğŸ® ê²Œì„í•˜ëŸ¬ ê°€ê¸°
                    </a>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ë­í‚¹ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        window.onload = async function () {
            try {
                const response = await fetch('/api/rankings');
                const rankings = await response.json();

                document.getElementById('loadingMessage').style.display = 'none';

                if (rankings.length === 0) {
                    document.getElementById('noDataMessage').style.display = 'block';
                } else {
                    displayRankings(rankings);
                    document.getElementById('rankingTable').style.display = 'block';
                }
            } catch (error) {
                document.getElementById('loadingMessage').innerHTML =
                    '<div class="text-danger">ë­í‚¹ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</div>';
            }
        };

        function displayRankings(rankings) {
            const tbody = document.getElementById('rankingBody');
            tbody.innerHTML = '';

            rankings.forEach((ranking, index) => {
                const row = document.createElement('tr');

                // ìˆœìœ„ë³„ ì•„ì´ì½˜ê³¼ ìŠ¤íƒ€ì¼
                let rankIcon = '';
                let rankClass = '';
                if (index === 0) {
                    rankIcon = 'ğŸ¥‡';
                    rankClass = 'table-warning';
                } else if (index === 1) {
                    rankIcon = 'ğŸ¥ˆ';
                    rankClass = 'table-secondary';
                } else if (index === 2) {
                    rankIcon = 'ğŸ¥‰';
                    rankClass = 'table-info';
                }

                row.className = rankClass;
                row.innerHTML = `
                    <td class="text-center fw-bold">${rankIcon} ${index + 1}</td>
                    <td class="fw-bold">${ranking.name}</td>
                    <td>${ranking.school}</td>
                    <td class="text-center">${ranking.grade}í•™ë…„</td>
                    <td class="text-center fw-bold text-primary">${ranking.score}ì </td>
                    <td class="text-center"><small>${formatDate(ranking.date)}</small></td>
                `;

                tbody.appendChild(row);
            });
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const day = date.getDate().toString().padStart(2, '0');
            const hours = date.getHours().toString().padStart(2, '0');
            const minutes = date.getMinutes().toString().padStart(2, '0');
            return `${month}/${day} ${hours}:${minutes}`;
        }
    </script>
</body>

</html>